{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Devolutions Gateway Configuration",
  "type": "object",
  "properties": {
    "Id": {
      "type": "string",
      "format": "uuid"
    },
    "Hostname": {
      "type": "string"
    },
    "ProvisionerPublicKeyFile": {
      "type": "string"
    },
    "ProvisionerPublicKeyData": {
      "$ref": "#/definitions/ConfDataPubKeyFormat"
    },
    "ProvisionerPrivateKeyFile": {
      "type": "string"
    },
    "ProvisionerPrivateKeyData": {
      "$ref": "#/definitions/ConfDataPrivKeyFormat"
    },
    "SubProvisionerPublicKey": {
      "$ref": "#/definitions/SubProvisionerKeyConf"
    },
    "DelegationPrivateKeyFile": {
      "type": "string"
    },
    "DelegationPrivateKeyData": {
      "$ref": "#/definitions/ConfDataPrivKeyFormat"
    },
    "TlsCertificateSource": {
      "$ref": "#/definitions/CertSource"
    },
    "TlsCertificateFile": {
      "type": "string"
    },
    "TlsPrivateKeyFile": {
      "type": "string"
    },
    "TlsPrivateKeyPassword": {
      "type": "string"
    },
    "TlsCertificateSubjectName": {
      "type": "string"
    },
    "TlsCertificateStoreName": {
      "type": "string"
    },
    "TlsCertificateStoreLocation": {
      "$ref": "#/definitions/CertStoreLocation"
    },
    "Listeners": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/ListenerConf"
      }
    },
    "Subscriber": {
      "$ref": "#/definitions/Subscriber"
    },
    "RecordingPath": {
      "type": "string"
    },
    "Ngrok": {
      "$ref": "#/definitions/NgrokConf"
    },
    "VerbosityProfile": {
      "$ref": "#/definitions/VerbosityProfile"
    },
    "WebApp": {
      "$ref": "#/definitions/WebAppConf"
    },
    "LogFile": {
      "type": "string"
    },
    "JrlFile": {
      "type": "string"
    },
    "Plugins": {
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "Sogar": {
      "$ref": "#/definitions/SogarConf"
    },
    "__debug__": {
      "$ref": "#/definitions/DebugConf"
    }
  },
  "required": ["Listeners"],
  "additionalProperties": true,
  "definitions": {
    "ConfDataPubKeyFormat": {
      "type": "object",
      "properties": {
        "Value": {
          "type": "string"
        },
        "Format": {
          "$ref": "#/definitions/PubKeyFormat"
        },
        "Encoding": {
          "$ref": "#/definitions/DataEncoding"
        }
      },
      "required": ["Value"],
      "additionalProperties": false
    },
    "ConfDataPrivKeyFormat": {
      "type": "object",
      "properties": {
        "Value": {
          "type": "string"
        },
        "Format": {
          "$ref": "#/definitions/PrivKeyFormat"
        },
        "Encoding": {
          "$ref": "#/definitions/DataEncoding"
        }
      },
      "required": ["Value"],
      "additionalProperties": false
    },
    "DataEncoding": {
      "type": "string",
      "enum": ["Multibase", "Base64", "Base64Pad", "Base64Url", "Base64UrlPad"],
      "default": "Multibase"
    },
    "PubKeyFormat": {
      "type": "string",
      "enum": ["Spki", "Pkcs1"],
      "default": "Spki"
    },
    "PrivKeyFormat": {
      "type": "string",
      "enum": ["Pkcs8", "Pkcs1", "Ec"],
      "default": "Pkcs8"
    },
    "SubProvisionerKeyConf": {
      "type": "object",
      "properties": {
        "Id": {
          "type": "string"
        },
        "Value": {
          "type": "string"
        },
        "Format": {
          "$ref": "#/definitions/PubKeyFormat"
        },
        "Encoding": {
          "$ref": "#/definitions/DataEncoding"
        }
      },
      "required": ["Id", "Value"],
      "additionalProperties": false
    },
    "CertSource": {
      "type": "string",
      "enum": ["External", "System"],
      "default": "External"
    },
    "CertStoreLocation": {
      "type": "string",
      "enum": ["CurrentUser", "CurrentService", "LocalMachine"],
      "default": "CurrentUser"
    },
    "ListenerConf": {
      "type": "object",
      "properties": {
        "InternalUrl": {
          "type": "string",
          "format": "uri"
        },
        "ExternalUrl": {
          "type": "string",
          "format": "uri"
        }
      },
      "required": ["InternalUrl", "ExternalUrl"],
      "additionalProperties": false
    },
    "Subscriber": {
      "type": "object",
      "properties": {
        "Url": {
          "type": "string",
          "format": "uri"
        },
        "Token": {
          "type": "string"
        }
      },
      "required": ["Url", "Token"],
      "additionalProperties": false
    },
    "NgrokConf": {
      "type": "object",
      "properties": {
        "AuthToken": {
          "type": "string"
        },
        "HeartbeatInterval": {
          "type": "integer"
        },
        "HeartbeatTolerance": {
          "type": "integer"
        },
        "Metadata": {
          "type": "string"
        },
        "ServerAddr": {
          "type": "string"
        },
        "Tunnels": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/NgrokTunnelConf"
          }
        }
      },
      "required": ["AuthToken"],
      "additionalProperties": false
    },
    "NgrokTunnelConf": {
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "proto": {
              "type": "string",
              "enum": ["tcp"]
            },
            "RemoteAddr": {
              "type": "string"
            },
            "Metadata": {
              "type": "string"
            },
            "AllowCidrs": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": []
            },
            "DenyCidrs": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": []
            }
          },
          "required": ["proto", "RemoteAddr"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "proto": {
              "type": "string",
              "enum": ["http"]
            },
            "Domain": {
              "type": "string"
            },
            "Metadata": {
              "type": "string"
            },
            "CircuitBreaker": {
              "type": "number"
            },
            "Compression": {
              "type": "boolean"
            },
            "AllowCidrs": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": []
            },
            "DenyCidrs": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": []
            }
          },
          "required": ["proto", "Domain"],
          "additionalProperties": false
        }
      ]
    },
    "VerbosityProfile": {
      "type": "string",
      "enum": ["Default", "Debug", "Tls", "All", "Quiet"],
      "default": "Default"
    },
    "WebAppConf": {
      "type": "object",
      "properties": {
        "Enabled": {
          "type": "boolean"
        },
        "Authentication": {
          "$ref": "#/definitions/WebAppAuth"
        },
        "AppTokenMaximumLifetime": {
          "type": "integer",
          "description": "Maximum lifetime granted for application tokens, in seconds",
          "default": 28800
        },
        "LoginLimitRate": {
          "type": "integer",
          "description": "The maximum number of login requests per minute",
          "default": 10
        },
        "UsersFile": {
          "type": "string"
        },
        "StaticRootPath": {
          "type": "string"
        }
      },
      "required": ["Enabled", "Authentication"],
      "additionalProperties": false
    },
    "WebAppAuth": {
      "type": "string",
      "enum": ["Custom", "None"]
    },
    "SogarConf": {
      "type": "object",
      "properties": {
        "RegistryUrl": {
          "type": "string"
        },
        "Username": {
          "type": "string"
        },
        "Password": {
          "type": "string"
        },
        "ImageName": {
          "type": "string",
          "default": "videos"
        },
        "UserList": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/SogarUser"
          },
          "default": []
        },
        "ServeAsRegistry": {
          "type": "boolean",
          "default": false
        },
        "RegistryName": {
          "type": "string",
          "default": "devolutions_registry"
        },
        "RegistryImage": {
          "type": "string",
          "default": "videos"
        },
        "PushFiles": {
          "type": "boolean",
          "default": false
        },
        "KeepFiles": {
          "type": "boolean",
          "default": false
        },
        "KeepTime": {
          "type": "integer"
        }
      },
      "required": ["RegistryUrl", "Username", "Password", "ImageName"],
      "additionalProperties": false
    },
    "SogarUser": {
      "type": "object",
      "properties": {
        "Password": {
          "type": "string"
        },
        "Username": {
          "type": "string"
        },
        "Permission": {
          "$ref": "#/definitions/SogarPermission"
        }
      },
      "additionalProperties": false
    },
    "SogarPermission": {
      "type": "string",
      "enum": ["Push", "Pull"]
    },
    "DebugConf": {
      "type": "object",
      "properties": {
        "dump_tokens": {
          "type": "boolean",
          "default": false
        },
        "disable_token_validation": {
          "type": "boolean",
          "default": false
        },
        "override_kdc": {
          "$ref": "#/definitions/TargetAddr"
        },
        "log_directives": {
          "type": "string"
        },
        "capture_path": {
          "type": "string"
        },
        "lib_xmf_path": {
          "type": "string"
        },
        "enable_unstable": {
          "type": "boolean",
          "default": false
        }
      },
      "additionalProperties": false
    },
    "TargetAddr": {
      "type": "string"
    }
  }
}
