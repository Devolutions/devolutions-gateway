[package]
name = "devolutions-gateway"
version = "2023.1.0"
edition = "2021"
readme = "README.md"
license = "MIT/Apache-2.0"
authors = ["Devolutions Inc. <infos@devolutions.net>"]
description = "Protocol-aware fine-grained relay server"
publish = false

[features]
default = []
openapi = ["dep:utoipa"]

[dependencies]

# in-house
transport = { path = "../crates/transport" }
jet-proto = { path = "../crates/jet-proto" }
jmux-proxy = { path = "../crates/jmux-proxy" }
sogar-core = { version = "0.3", git = "https://github.com/Devolutions/sogar", branch = "hyper-update" }
ironrdp = { version = "0.4.1", git = "https://github.com/Devolutions/IronRDP", rev = "aa85fe4869aad3a1e1827" }
ironrdp-devolutions-gateway = { version = "0.1.0", git = "https://github.com/Devolutions/IronRDP", rev = "898fb8d40a3c84" }
ceviche = "0.5.2"
picky-krb = "0.3.1"

# serialization
serde = "1.0.143"
serde_derive = "1.0.143"
serde_json = "1.0.83"

# utils, misc
hostname = "0.3.1"
camino = { version = "1.0.9", features = ["serde1"] }
smol_str = "0.1.23"
nonempty = "0.8.0"
tap = "1.0.1"
byteorder = "1.4.3"
lazy_static = "1.4.0"
bytes = "1.3"
cfg-if = "1.0.0"
url = { version = "2.2.2", features = ["serde"] }
tempfile = "3.3.0"
indexmap = "1.9.1"
uuid = { version = "1.1.2", features = ["v4", "serde"] }
chrono = { version = "0.4.21", features = ["serde"] } # TODO: switch to `time`
parking_lot = "0.12.1"
anyhow = "1.0.61"
thiserror = "1.0.37"
typed-builder = "0.10.0"
# Unicode case folding comparisons
focaccia = "1.2.0"
backoff = "0.4.0"

# security, crypto…
zeroize = { version = "1.5.7", features = ["derive"] }
rust-argon2 = "1.0.0"
picky = { version = "7.0.0-rc.3", default-features = false, features = ["jose", "x509"] }
sspi = "0.3.2"
# evaluate use of ring in our codebase
ring = "0.16.20"
# (unrequired if using `axum`)
sha1 = "0.10.1"
# (unrequired if using `axum`)
base64 = "0.13.0"
multihash = "0.16.3"
multibase = "0.9.1"

# logging
tracing = "0.1.36"
tracing-subscriber = { version = "0.3.15", features = ["env-filter", "parking_lot", "smallvec", "local-time", "tracing-log"] }
tracing-appender = "0.2.2"
# TODO: consider `tracing-error` crate

# async, futures…
tokio = { version = "1.20.1", features = ["signal", "net", "io-util", "time", "rt", "rt-multi-thread", "sync", "macros", "parking_lot"] }
tokio-util = { version = "0.7.3", features = ["codec"] }
tokio-tungstenite = "0.17.2"
tokio-rustls = { version = "0.23.4", features = ["dangerous_configuration", "tls12"] }
futures = "0.3.21"

# Safe pin projection
pin-project-lite = "0.2.9"

# http
hyper = "0.14.20"
# NOTE: maybe directly use hyper (we already use hyper)
reqwest = "0.11.11"
http = "0.2.8"
# FIXME: update once next saphir version is published or use `axum`/`warp`
saphir = { version = "2.8", default-features = false, features = ["json", "macro", "form", "operation", "file"], git = "https://github.com/CBenoit/saphir", branch = "hyper-update" }
# for KDC proxy
portpicker = "0.1.1"
# OpenAPI generator
utoipa = { version = "2.0.1", default-features = false, features = ["uuid", "chrono"], optional = true }

# plugins
dlopen = "0.1.8"
dlopen_derive = "0.1.4"
# Dependencies required for PCAP support (FIXME: should we keep that built-in?)
pcap-file = "1.1.1"
packet = { git = "https://github.com/fdubois1/rust-packet.git" }

[target.'cfg(windows)'.build-dependencies]
embed-resource = "1.7.3"

[dev-dependencies]
tokio-test = "0.4.2"
proptest = "1.0.0"
rstest = "0.15.0"
devolutions-gateway-generators = { path = "../crates/devolutions-gateway-generators" }
